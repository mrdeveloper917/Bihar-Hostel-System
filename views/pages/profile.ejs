<% title = "My Profile" %>

<section class="container py-5">

  <!-- ================= PROFILE HEADER ================= -->
  <div class="profile-header glass-card p-5 mb-5 rounded-5 shadow-lg d-flex flex-column flex-md-row align-items-center justify-content-between position-relative overflow-hidden">
    <!-- Avatar + Info -->
    <div class="d-flex align-items-center gap-4">
      <div class="avatar-wrapper position-relative">
        <div class="avatar-glow"></div>
        <img id="profileImg"
          src="<%= student.profileImage || '/images/default-avatar.png' %>"
          alt="Profile Picture"
          class="avatar-img"
        />
        <button class="btn btn-light edit-btn rounded-circle"
          data-bs-toggle="modal"
          data-bs-target="#uploadPhotoModal"
          title="Change Photo">
          <i class="bi bi-camera-fill"></i>
        </button>
      </div>
      <div>
        <h2 class="fw-bold text-gradient mb-1 animate-fade"><%= user.name %></h2>
        <p class="text-muted mb-0 small"><i class="bi bi-envelope me-1"></i><%= user.email %></p>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-4 mt-md-0 d-flex gap-3 flex-wrap justify-content-center">
      <button class="btn btn-outline-primary rounded-pill px-4 fw-semibold action-btn"
        data-bs-toggle="modal" data-bs-target="#editProfileModal">
        <i class="bi bi-pencil-square me-1"></i> Edit Info
      </button>
      <a href="/student/bookings" class="btn btn-primary rounded-pill px-4 fw-semibold action-btn">
        <i class="bi bi-calendar-plus me-1"></i> Book Room
      </a>
      <a href="/student/complaints" class="btn btn-danger rounded-pill px-4 fw-semibold action-btn">
        <i class="bi bi-chat-dots me-1"></i> File Complaint
      </a>
    </div>

    <!-- Animated Background Glow -->
    <div class="header-animated-glow"></div>
  </div>

  <!-- ================= STUDENT INFO ================= -->
  <div class="info-card glass-card rounded-5 shadow-md mb-4 p-4">
    <h5 class="fw-semibold text-primary mb-4 d-flex align-items-center">
      <i class="bi bi-person-badge me-2"></i> Student Information
    </h5>
    <div class="row g-4">
      <div class="col-md-6">
        <p class="small text-muted mb-1">Roll Number</p>
        <h6 class="fw-semibold"><%= student.roll %></h6>
      </div>
      <div class="col-md-6">
        <p class="small text-muted mb-1">Hostel Name</p>
        <h6 class="fw-semibold"><%= student.hostelName || "Not Assigned" %></h6>
      </div>
      <div class="col-md-6">
        <p class="small text-muted mb-1">Room Number</p>
        <h6 class="fw-semibold"><%= student.roomNumber || "Not Allotted" %></h6>
      </div>
      <div class="col-md-6">
        <p class="small text-muted mb-1">Fee Status</p>
        <span class="badge px-3 py-2 fs-6 <%= student.feeStatus === 'Paid' ? 'bg-success' : 'bg-danger' %>">
          <%= student.feeStatus || 'Unpaid' %>
        </span>
      </div>
    </div>
  </div>

  <!-- ================= BOOKINGS ================= -->
  <div class="info-card glass-card rounded-5 shadow-md mb-4 p-4">
    <h5 class="fw-semibold text-info mb-4 d-flex align-items-center">
      <i class="bi bi-calendar2-check me-2"></i> My Bookings
    </h5>
    <% if (bookings.length > 0) { %>
    <ul class="list-group list-group-flush">
      <% bookings.forEach(b => { %>
      <li class="list-group-item border-0 border-bottom d-flex justify-content-between align-items-center py-3 animate-fade">
        <div>
          Room <strong><%= b.roomNumber %></strong>
          <span class="badge ms-2 <%= b.status === 'approved' ? 'bg-success' : b.status === 'pending' ? 'bg-warning text-dark' : 'bg-danger' %>">
            <%= b.status %>
          </span>
        </div>
        <small class="text-muted"><%= new Date(b.createdAt).toLocaleDateString() %></small>
      </li>
      <% }) %>
    </ul>
    <% } else { %>
    <p class="text-muted text-center py-3">No bookings yet.</p>
    <% } %>
  </div>

  <!-- ================= COMPLAINTS ================= -->
  <div class="info-card glass-card rounded-5 shadow-md p-4">
    <h5 class="fw-semibold text-danger mb-4 d-flex align-items-center">
      <i class="bi bi-exclamation-circle me-2"></i> My Complaints
    </h5>
    <% if (complaints.length > 0) { %>
    <ul class="list-group list-group-flush">
      <% complaints.forEach(c => { %>
      <li class="list-group-item border-0 border-bottom d-flex justify-content-between align-items-center py-3 animate-fade">
        <span><%= c.description.substring(0, 60) %>...</span>
        <span class="badge <%= c.status === 'resolved' ? 'bg-success' : 'bg-warning text-dark' %>"><%= c.status %></span>
      </li>
      <% }) %>
    </ul>
    <% } else { %>
    <p class="text-muted text-center py-3">No complaints yet.</p>
    <% } %>
  </div>
</section>

<!-- =================== MODALS =================== -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-5 border-0 shadow-lg modal-glass">
      <div class="modal-header modal-header-gradient text-white rounded-top-5">
        <h5 class="modal-title d-flex align-items-center">
          <i class="bi bi-pencil-square me-2"></i> Edit Profile
        </h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="editProfileForm" class="row g-3">
          <div class="col-md-6 form-floating">
            <input type="text" class="form-control" id="hostelName" value="<%= student.hostelName || '' %>" placeholder="Hostel Name" required />
            <label for="hostelName">Hostel Name</label>
          </div>
          <div class="col-md-6 form-floating">
            <input type="text" class="form-control" id="roomNumber" value="<%= student.roomNumber || '' %>" placeholder="Room Number" required />
            <label for="roomNumber">Room Number</label>
          </div>
          <div class="col-12 form-floating">
            <select class="form-select" id="feeStatus" required>
              <option value="Paid" <%= student.feeStatus === 'Paid' ? 'selected' : '' %>>Paid</option>
              <option value="Unpaid" <%= student.feeStatus === 'Unpaid' ? 'selected' : '' %>>Unpaid</option>
            </select>
            <label for="feeStatus">Fee Status</label>
          </div>
          <div class="text-end mt-4">
            <button type="submit" class="btn btn-primary rounded-pill px-4 fw-semibold shadow-hover">
              <i class="bi bi-check-circle me-1"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-5 border-0 shadow-lg modal-glass">
      <div class="modal-header modal-header-gradient text-white rounded-top-5">
        <h5 class="modal-title d-flex align-items-center">
          <i class="bi bi-camera-fill me-2"></i> Change Profile Picture
        </h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center p-4">
        <form id="uploadForm" enctype="multipart/form-data">
          <div class="mb-3">
            <div class="preview-frame mx-auto mb-3 shadow-glow">
              <img id="previewImg" src="<%= student.profileImage || '/images/default-avatar.png' %>" class="img-preview" />
            </div>
            <input type="file" name="profilePic" id="profilePic" class="form-control shadow-sm" accept="image/*" required />
          </div>
          <button type="submit" class="btn btn-primary rounded-pill px-4 fw-semibold shadow-hover">
            <i class="bi bi-cloud-arrow-up me-1"></i> Upload
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- =================== STYLES =================== -->
<style>
body {
  background: radial-gradient(circle at top left, #f9fbff, #eef2f8);
  font-family: "Poppins", sans-serif;
  color: #333;
  overflow-x: hidden;
}

/* ====== Glass Effects ====== */
.glass-card {
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, 0.4);
  transition: all 0.35s ease;
}
.glass-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
}

/* ====== Avatar ====== */
.avatar-wrapper {
  position: relative;
}
.avatar-img {
  width: 130px;
  height: 130px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid white;
  transition: all 0.4s ease;
}
.avatar-img:hover {
  transform: scale(1.08);
}
.avatar-glow {
  position: absolute;
  width: 140px;
  height: 140px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(0,123,255,0.25), transparent 70%);
  filter: blur(15px);
  z-index: -1;
}

/* ====== Buttons ====== */
.action-btn {
  position: relative;
  overflow: hidden;
  z-index: 1;
}
.action-btn::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(0,0,0,0.05));
  opacity: 0;
  transition: opacity 0.3s;
}
.action-btn:hover::after {
  opacity: 1;
}

/* ====== Header Glow Animation ====== */
.header-animated-glow {
  position: absolute;
  top: -40%;
  right: -30%;
  width: 400px;
  height: 400px;
  background: radial-gradient(circle, rgba(0,123,255,0.25), rgba(102,16,242,0.1));
  filter: blur(90px);
  animation: moveGlow 6s infinite alternate ease-in-out;
  z-index: 0;
}
@keyframes moveGlow {
  from { transform: translate(0,0); }
  to { transform: translate(-50px, 40px); }
}

/* ====== Modal ====== */
.modal-glass {
  background: rgba(255, 255, 255, 0.96);
  backdrop-filter: blur(15px);
}
.modal-header-gradient {
  background: linear-gradient(135deg, #007bff, #6610f2);
}

/* ====== Animations ====== */
.animate-fade {
  animation: fadeIn 0.6s ease forwards;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
.text-gradient {
  background: linear-gradient(90deg, #007bff, #6610f2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.shadow-glow {
  box-shadow: 0 0 25px rgba(0, 123, 255, 0.25);
}
</style>
