<% title = "Hostel Inventory Management" %>

<section class="container-fluid py-5 px-md-4 animate__animated animate__fadeIn">
  <!-- Header -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-5 rounded-4 shadow-glass p-4">
    <div>
      <h2 class="fw-bold gradient-text mb-1">üè† Hostel Inventory</h2>
      <p class="text-muted small mb-0">
        Manage all hostel items, their condition, and assign them to rooms.
      </p>
    </div>
    <button
      class="btn btn-gradient rounded-pill shadow-sm mt-3 mt-md-0"
      data-bs-toggle="modal"
      data-bs-target="#addItemModal"
    >
      <i class="bi bi-plus-circle me-2"></i> Add New Item
    </button>
  </div>

  <!-- Inventory Table -->
  <div class="glass-card p-4 shadow-glass">
    <% if (items.length === 0) { %>
    <div class="text-center py-5">
      <i class="bi bi-box-seam fs-1 text-muted"></i>
      <h5 class="fw-semibold mt-3">No Inventory Items Found</h5>
      <p class="text-secondary small">Add new items using the button above.</p>
    </div>
    <% } else { %>
    <div class="table-responsive">
      <table class="table align-middle table-hover">
        <thead class="table-light">
          <tr>
            <th>Item Name</th>
            <th>Quantity</th>
            <th>Condition</th>
            <th>Room</th>
            <th>Assigned To</th>
            <th>Last Checked</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% items.forEach(i => { %>
          <tr>
            <td><%= i.itemName %></td>
            <td><%= i.quantity %></td>
            <td>
              <span
                class="badge 
                  <%= i.condition === 'Good' ? 'bg-success' : 
                      i.condition === 'Under Maintenance' ? 'bg-warning text-dark' : 'bg-danger' %>"
              >
                <%= i.condition %>
              </span>
            </td>
            <td><%= i.room || '-' %></td>
            <td><%= i.assignedTo ? i.assignedTo.user : 'Unassigned' %></td>
            <td><%= new Date(i.lastChecked).toLocaleDateString() %></td>
            <td>
              <button
                class="btn btn-sm btn-outline-primary rounded-pill"
                data-bs-toggle="modal"
                data-bs-target="#updateItemModal<%= i._id %>"
              >
                <i class="bi bi-pencil"></i>
              </button>
              <form
                action="/admin/inventory/<%= i._id %>/delete"
                method="POST"
                class="d-inline"
              >
                <button
                  class="btn btn-sm btn-outline-danger rounded-pill"
                  onclick="return confirm('Delete this item?');"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </form>
            </td>
          </tr>

          <!-- Update Item Modal -->
          <div
            class="modal fade"
            id="updateItemModal<%= i._id %>"
            tabindex="-1"
          >
            <div class="modal-dialog">
              <form
                action="/admin/inventory/<%= i._id %>/update"
                method="POST"
                class="modal-content"
              >
                <div class="modal-header">
                  <h5 class="modal-title">Update Item</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3">
                    <label class="form-label">Condition</label>
                    <select name="condition" class="form-select">
                      <option value="Good">Good</option>
                      <option value="Under Maintenance">
                        Under Maintenance
                      </option>
                      <option value="Damaged">Damaged</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Damage Charge (‚Çπ)</label>
                    <input
                      type="number"
                      name="damageCharge"
                      class="form-control"
                      placeholder="Enter charge if applicable"
                    />
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Cancel
                  </button>
                  <button type="submit" class="btn btn-primary">
                    Save Changes
                  </button>
                </div>
              </form>
            </div>
          </div>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</section>

<!-- Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1">
  <div class="modal-dialog">
    <form action="/admin/inventory/add" method="POST" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Inventory Item</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Item Name</label>
          <input type="text" name="itemName" class="form-control" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Quantity</label>
          <input type="number" name="quantity" class="form-control" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Condition</label>
          <select name="condition" class="form-select">
            <option value="Good">Good</option>
            <option value="Under Maintenance">Under Maintenance</option>
            <option value="Damaged">Damaged</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Room</label>
          <input type="text" name="room" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Remarks</label>
          <textarea name="remarks" class="form-control"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Add Item</button>
      </div>
    </form>
  </div>
</div>

<!-- Styles -->
<style>
  body {
    background: radial-gradient(circle at top left, #eef3ff, #f8faff 70%);
    font-family: "Poppins", sans-serif;
  }
  .gradient-text {
    background: linear-gradient(90deg, #007bff, #6610f2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .glass-card {
    background: rgba(255, 255, 255, 0.96);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    transition: 0.4s;
  }
  .glass-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 30px rgba(0, 0, 0, 0.1);
  }
  .btn-gradient {
    background: linear-gradient(90deg, #007bff, #00bfff);
    color: #fff;
    border: none;
  }
  .btn-gradient:hover {
    background: linear-gradient(90deg, #0069d9, #0099cc);
  }
</style>
