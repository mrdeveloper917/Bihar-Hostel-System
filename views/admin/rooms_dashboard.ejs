<% title = "Room Status Dashboard" %>

<section class="container py-5 animate__animated animate__fadeIn">
  <!-- ===== Header ===== -->
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-5"
  >
    <div>
      <h2 class="fw-bold text-gradient mb-1">üè† Room Status Dashboard</h2>
      <p class="text-muted small mb-0">
        Monitor all hostel rooms, occupants, capacity & availability.
      </p>
    </div>

    <div class="d-flex gap-2 mt-3 mt-md-0">
      <a href="/admin" class="btn btn-light rounded-pill shadow-sm px-4">
        <i class="bi bi-speedometer2 me-1"></i> Admin Dashboard
      </a>

      <button
        class="btn btn-gradient rounded-pill shadow-sm px-4"
        onclick="location.reload()"
      >
        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
      </button>
    </div>
  </div>

  <!-- ===== Summary Cards ===== -->
  <div class="row g-4 mb-5 text-center">
    <div class="col-md-4">
      <div class="summary-card bg-gradient-success p-4 rounded-4 shadow">
        <h3 class="fw-bold mb-1">
          <%= rooms.filter(r => !r.isOccupied).length %>
        </h3>
        <p class="mb-0 small text-light">Vacant Rooms</p>
      </div>
    </div>

    <div class="col-md-4">
      <div class="summary-card bg-gradient-danger p-4 rounded-4 shadow">
        <h3 class="fw-bold mb-1">
          <%= rooms.filter(r => r.isOccupied).length %>
        </h3>
        <p class="mb-0 small text-light">Occupied Rooms</p>
      </div>
    </div>

    <div class="col-md-4">
      <div class="summary-card bg-gradient-primary p-4 rounded-4 shadow">
        <h3 class="fw-bold mb-1"><%= rooms.length %></h3>
        <p class="mb-0 small text-light">Total Rooms</p>
      </div>
    </div>
  </div>

  <!-- ===== Room Grid ===== -->
  <div class="row g-4">
    <% rooms.forEach(r => { %>
    <div class="col-lg-3 col-md-4 col-sm-6">
      <div
        class="room-card text-center shadow-sm p-3 rounded-4 <%= r.isOccupied ? 'occupied' : 'vacant' %>"
      >
        <div class="room-header mb-2">
          <h5 class="fw-bold mb-1">Room <%= r.roomNumber %></h5>

          <p class="small text-muted mb-1">
            <i class="bi bi-buildings me-1"></i><%= r.hostelName %><br />
            <i class="bi bi-people-fill me-1"></i>Capacity: <%= r.capacity %>
          </p>
        </div>

        <!-- Status Badge -->
        <div class="room-status mb-2">
          <span
            class="badge px-3 py-2 rounded-pill fw-semibold <%= r.isOccupied ? 'bg-danger' : 'bg-success' %>"
          >
            <%= r.isOccupied ? 'Occupied' : 'Vacant' %>
          </span>
        </div>

        <!-- Occupants -->
        <% if (r.occupants && r.occupants.length > 0) { %>
        <div class="occupants mt-2">
          <ul class="list-unstyled small mb-0">
            <% r.occupants.forEach(o => { %>
            <li class="text-dark">
              <i class="bi bi-person-circle text-primary me-1"></i>
              <%= o.name || o.user?.name || "Student" %>
            </li>
            <% }) %>
          </ul>
        </div>
        <% } else { %>
        <p class="text-secondary small fst-italic mt-2">
          No occupants assigned
        </p>
        <% } %>
      </div>
    </div>
    <% }) %>
  </div>

  <!-- Legend -->
  <div class="mt-5 text-center small">
    <span class="badge bg-success me-2">Vacant</span>
    <span class="badge bg-danger me-2">Occupied</span>
    <span class="badge bg-secondary">Mixed/Partial</span>
  </div>
</section>

<!-- ===== Styles ===== -->
<style>
  body {
    background: linear-gradient(135deg, #f6f9ff, #e9f1ff);
    font-family: "Poppins", sans-serif;
  }

  .text-gradient {
    background: linear-gradient(90deg, #007bff, #6610f2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Summary Cards */
  .summary-card {
    border-radius: 18px;
    transition: 0.3s ease;
    color: white;
  }
  .summary-card:hover {
    transform: translateY(-5px);
    box-shadow: 0px 12px 28px rgba(0, 0, 0, 0.12);
  }
  .bg-gradient-success {
    background: linear-gradient(90deg, #28a745, #20c997);
  }
  .bg-gradient-danger {
    background: linear-gradient(90deg, #dc3545, #ff6b81);
  }
  .bg-gradient-primary {
    background: linear-gradient(90deg, #007bff, #6610f2);
  }

  /* Room Cards */
  .room-card {
    transition: 0.4s ease;
    border: 2px solid transparent;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    min-height: 240px;
  }
  .room-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0px 15px 35px rgba(0, 0, 0, 0.1);
  }
  .room-card.vacant {
    border-color: #28a745;
    background: rgba(40, 167, 69, 0.08);
  }
  .room-card.occupied {
    border-color: #dc3545;
    background: rgba(220, 53, 69, 0.08);
  }

  .badge {
    font-size: 0.75rem;
  }

  @media (max-width: 768px) {
    .room-card {
      padding: 1rem;
    }
    .summary-card h3 {
      font-size: 1.4rem;
    }
  }
</style>
