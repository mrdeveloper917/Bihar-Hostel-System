<% title = "Hostel Leave" %>

<section class="container py-5 animate__animated animate__fadeIn">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
    <div>
      <h2 class="fw-bold text-gradient mb-1">ğŸ“… Leave Applications</h2>
      <p class="text-muted small mb-0">
        Apply for leave and track your previous applications.
      </p>
    </div>

    <div class="d-flex align-items-center gap-2 mt-3 mt-md-0">
      <!-- Add Leave Application Button -->
      <button
        class="btn btn-success rounded-pill shadow-sm"
        data-bs-toggle="modal"
        data-bs-target="#leaveModal"
      >
        <i class="bi bi-plus-circle me-1"></i> Add Leave Application
      </button>
    </div>
  </div>

  <!-- SUCCESS / ERROR MESSAGES -->
  <% if (success) { %>
  <div class="alert alert-success"><%= success %></div>
  <% } %> <% if (error) { %>
  <div class="alert alert-danger"><%= error %></div>
  <% } %>

  <!-- Leave History Table -->
  <div class="card glass-card shadow-sm p-4">
    <h5 class="fw-bold mb-3 text-gradient">ğŸ“‹ Leave History</h5>

    <% if (!leaves || leaves.length === 0) { %>
    <p class="text-muted text-center py-3">
      No leave applications submitted yet.
    </p>
    <% } else { %>
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Reason</th>
            <th>From</th>
            <th>To</th>
            <th>Status</th>
            <th>Applied On</th>
          </tr>
        </thead>
        <tbody>
          <% leaves.forEach(l => { %>
          <tr>
            <td><%= l.reason %></td>
            <td><%= new Date(l.fromDate).toLocaleDateString() %></td>
            <td><%= new Date(l.toDate).toLocaleDateString() %></td>
            <td>
              <span
                class="badge bg-<%= l.status === 'Approved' ? 'success' : l.status === 'Rejected' ? 'danger' : 'warning text-dark' %>"
              >
                <%= l.status %>
              </span>
            </td>
            <td><%= new Date(l.createdAt).toLocaleDateString() %></td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</section>

<!-- LEAVE APPLICATION MODAL -->
<div
  class="modal fade"
  id="leaveModal"
  tabindex="-1"
  aria-labelledby="leaveModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content glass-card p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold text-gradient" id="leaveModalLabel">
          ğŸ“ New Leave Application
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>

      <form action="/student/leaves" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label fw-semibold">Leave Reason</label>
            <textarea
              name="reason"
              class="form-control rounded"
              placeholder="Reason for leave..."
              required
            ></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Start Date</label>
            <input
              type="date"
              name="fromDate"
              class="form-control rounded"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">End Date</label>
            <input
              type="date"
              name="toDate"
              class="form-control rounded"
              required
            />
          </div>
        </div>

        <div class="modal-footer border-0">
          <button
            type="button"
            class="btn btn-secondary rounded-pill"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-success rounded-pill px-4">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  .glass-card {
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(12px);
    border-radius: 18px;
    border: 1px solid rgba(255, 255, 255, 0.3);
  }
  .text-gradient {
    background: linear-gradient(90deg, #007bff, #6610f2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
</style>
